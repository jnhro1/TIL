# DATABASE-INDEX  
데이터베이스 설계 과정에서 테이블의 PK를 문자형 타입으로하냐 숫자형 타입으로 하냐 고민이 있었다.  
  
EX) 문자형 : varchar / AABBCC01 과 같이 문자+숫자형으로 이름만 봐도 내용물이 무엇인지 알 수 있게 한다.  
    숫자형 : int / auto_increment 로 만들기 쉬우나 내용물이 무엇인지는 알 수 없다.  
   
    팀원들과 이 문제에 관해 많은 토론을 하였고 그 결론을 작성해보고자 한다.  
    
  
  
## INDEX
- 책을 예시로 특정 챕터에서 첫 페이지를 찾거나 서점에서 책을 찾듯이 데이터베이스안에서 목차 역활 즉 색인 작업을 담당한다. 
- 인덱스는 특정 칼럼 값을 가지고 있는 열 혹은 값을 빠르게 찾기 위해서 사용된다. 
- MySQL은 첫 번째 열부터 전체 테이블에 걸쳐서 연관된 열을 검색하기 때문에 테이블이 크면 클 수록 비용이 엄청나게 늘어난다.  
만약 테이블이 쿼리에 있는 컬럼에 대한 인텍스를 가지고 있다면, MySQL은 모든 데이터를 조사하지 않고도 데이터 파일의 중간에서 검색위치를 빠르게 잡아낼 수 있다.  
인덱스 위주 검색 후, 관련된 혹은 원하는 데이터들을 가져올 수 있다고 생각할 수도 있다.
  
  
  
여러 실무 개발자분들께 인덱스의 문자형/숫자형에 대해서 물어본 결과 거의 절반 비율로 두 방법을 모두 사용하고 있었다.  
(꽤 오래된 중소기업은 대부분 문자형을. 스타트업은 숫자형을 사용하고 있었다.)  
각각의 사용 이유를 정리해보겠다. 
  
  
  
## 문자형 EX) AABBCC01
- 내용만 보고도 직관적으로 어떤 데이터를 담고 있는지 알 수 있다.
- 과거 SQL 취약점 해킹에 대비하기 위해
  
  
  

## 숫자형 EX) int + auto increment
- number 자체로 값을 자동증가하여 준다면 해당 데이터에 대한 접근이 쉽다.
- SQL injection에서 db의 인덱스값을 서비스 자체에 표현해주는것이 좋지 않다. (데이터 노출 최소화)
- 일단 편하다.
- pk는 보통 clustered index로 구현되는데 정렬의 기준이 pk 값이다. 그런데 만약 pk를 email과 같이 문자형으로 둔다면 INSERT가 일어날때마다 정렬이 이루어지며 분할 등등의 오버헤드가 발생한다.  
PK로 auto_increment를 둔다면 이러한 재정렬이 일어나지도 않고 마지막 행에만 추가가 이루어지기 때문에 위와 같은 오버헤드가 일어나지 않는다.  
만일 pk를 지정하지 않으면 mysql에서 자동으로 (암묵적으로) clustertd index를 생성하는데 이것은 쿼리문에서는 사용할 수가 없어서 비추천을 한다.  

  
  
  
## COG은 숫자형으로...!
- "편하다"라는 큰 메리트로 COG는 숫자형(auto increment)으로 pk를 지정하기로했다.
- 단, 기본키로 auto incement로 두되 대체키로 unique한 문자열을 사용한다.
- ex) user_idx (int/auto increment) user_email (varchar/unique)


  
  
  

### 참고
클러스터, 비클러스터의 개념 <https://mongyang.tistory.com/75/>

